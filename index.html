<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style type="text/css">
        body { margin: 20px; }
        html, body, button {
            font-family: monospace;
            font-size: 20px;
        }
        table {
            table-layout: auto;
            border: 1px solid;
        }
    </style>
    <title>Turing Completer</title>
</head>

<body onload="main();">
    <p>
        Turing Completer
        <br><input type="button" value="UNCHECK" onClick="uncheck()"/>
        <input type="button" value="PERMUTE (UNIQUES)" onClick="permute(true)"/>
        <input type="button" value="PERMUTE (ALL)" onClick="permute(false)"/>
        <br><div id="solution"></div>
        <br><div id="tableContainer"></div>
        <br><br><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">Turing Completer</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/marksilverman/spiromaniac" property="cc:attributionName" rel="cc:attributionURL">Mark Silverman</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    </p>
<script>

// interesting note: if the total is <= 6, there can't be a triple number

filterCount = 0;
var solutionElement = document.getElementById("solution");
function show(info) { solutionElement.innerHTML += info; }

var activated = "lightblue";
var locked = "lightgreen";

function toggleEnabled(checkbox)
{
    var row = checkbox.parentNode.parentNode;
    if (row.style.backgroundColor == "")
    {
        row.style.backgroundColor = activated;
        filterTable.insertBefore(row, filterTable.firstChild);
    }
    else if (row.style.backgroundColor == activated)
        row.style.backgroundColor = locked;
    else if (row.style.backgroundColor == locked)
        row.style.backgroundColor = "";
}

function addFilters(filters)
{
    var count = 0;
    var row = document.createElement("tr");
    row.id = "row" + filterCount;
    filterCount += 1;

    var rowStateButton = document.createElement("button");
    rowStateButton.onclick = function() { toggleEnabled(this); };
    rowStateButton.style.width = "20px";
    rowStateButton.style.height = "20px";
    rowStateButton.style.backgroundColor = "orange";
    var cell = document.createElement("td");
    cell.appendChild(rowStateButton);
    row.appendChild(cell);

    for (const [ desc, test ] of filters)
    {
        count += 1;
        var id = row.id + desc.replace(/ /g, '_');
        var input = document.createElement("input");

        var cell = document.createElement("td");

        if (test == null)
        {
            input.id = desc;
            input.type = "number";
        }
        else
        {
            input.id = id;
            input.type = "checkbox";
            input.onchange = function(){ refresh() };
        }

        var label = document.createElement("label");
        label.id = row.id + "-" + id + "-label";
        label.htmlFor = input.id;
        label.textContent = " " + desc;

        cell.appendChild(label);
        cell.appendChild(input);
        row.appendChild(cell);
        if (test) filterList.push([ input, test ]);
    }
    while (count < 10)
    {
        count += 1;
        row.appendChild(document.createElement("td"));
    }

    filterTable.appendChild(row);
}

var filterList = [ ];
var filterTable = document.createElement("table");
document.getElementById("tableContainer").appendChild(filterTable);

addFilters([ [ "blue < AA", "b < AA" ], [ "blue == AA", "b == AA" ], [ "blue > AA", "b > AA" ], [ "AA", null ] ]);
addFilters([ [ "yellow < BB", "y < BB" ], [ "yellow == BB", "y == BB" ], [ "yellow > BB", "y > BB" ], [ "BB", null ] ]);
addFilters([ [ "purple < CC", "p < CC" ], [ "purple == CC", "p == CC" ], [ "purple > CC", "p > CC" ], [ "CC", null ] ]);
addFilters([ [ "yellow + blue < DD", "(y + b) < DD" ], [ "yellow + blue == DD", "(y + b) == DD" ], [ "yellow + blue > DD", "(y + b) > DD" ], [ "DD", null ] ]);
addFilters([ [ "purple + blue < EE", "(p + b) < EE" ], [ "purple + blue == EE", "(p + b) == EE" ], [ "purple + blue > EE", "(p + b) > EE" ], [ "EE", null ] ]);
addFilters([ [ "yellow + purple < FF", "(y + p) < FF" ], [ "yellow + purple == FF", "(y + p) == FF" ], [ "yellow + purple > FF", "(y + p) > FF" ], [ "FF", null ] ]);

addFilters([ [ "blue + yellow = DD", "(b + y) == NN" ], [ "blue + purple = NN", "(b + p) == NN" ], [ "yellow + purple = NN", "(y + p) == NN" ], [ "NN", null ] ]);
addFilters([ [ "blue + yellow > DD", "(b + y) > OO" ], [ "blue + purple > OO", "(b + p) > OO" ], [ "yellow + purple > OO", "(y + p) > OO" ], [ "OO", null ] ]);
addFilters([ [ "blue + yellow < DD", "(b + y) < PP" ], [ "blue + purple < PP", "(b + p) < PP" ], [ "yellow + purple < PP", "(y + p) < PP" ], [ "PP", null ] ]);

addFilters([ [ "blue + yellow + purple < GG", "(b + y + p) < GG" ],
             [ "blue + yellow + purple == GG", "(b + y + p) == GG" ],
             [ "blue + yellow + purple > GG", "(b + y + p) > GG" ],
             [ "GG", null ] ]);

addFilters([ [ "no HH", "b != HH && y != HH && p != HH" ],
             [ "one HH", "((b == HH) + (y == HH) + (p == HH)) == 1" ],
             [ "two HH", "((b == HH) + (y == HH) + (p == HH)) == 2" ], [ "HH", null ] ]);

addFilters([ [ "no II", "b != II && y != II && p != II" ],
             [ "one II", "((b == II) + (y == II) + (p == II)) == 1" ],
             [ "two II", "((b == II) + (y == II) + (p == II)) == 2" ], [ "II", null ] ]);

addFilters([ [ "no JJ", "b != JJ && y != JJ && p != JJ" ],
             [ "one JJ", "((b == JJ) + (y == JJ) + (p == JJ)) == 1" ],
             [ "two JJ", "((b == JJ) + (y == JJ) + (p == JJ)) == 2" ], [ "JJ", null ] ]);

addFilters([ [ "blue < KK", "b < KK" ], [ "yellow < KK", "y < KK" ], [ "purple < KK", "p < KK" ], [ "KK", null ] ]);
addFilters([ [ "blue = LL", "b == LL" ], [ "yellow = LL", "y == LL" ], [ "purple = LL", "p == LL" ], [ "LL", null ] ]);
addFilters([ [ "blue > MM", "b > MM" ], [ "yellow > MM", "y > MM" ], [ "purple > MM", "p > MM" ], [ "MM", null ] ]);

addFilters([
    [ "blue < QQ", "b < QQ" ],
    [ "yellow < QQ", "y < QQ" ],
    [ "purple < QQ", "p < QQ" ],
    [ "blue = QQ", "b == QQ" ],
    [ "yellow = QQ", "y == QQ" ],
    [ "purple = QQ", "p == QQ" ],
    [ "blue > QQ", "b > QQ" ],
    [ "yellow > QQ", "y > QQ" ],
    [ "purple > QQ", "p > QQ" ],
    [ "QQ", null ] ]);

addFilters([
    [ "no RR", "b != RR && y != RR && p != RR" ],
    [ "one RR", "((b == RR) + (y == RR) + (p == RR)) == 1" ],
    [ "two RR", "((b == RR) + (y == RR) + (p == RR)) == 2" ],
    [ "no SS", "b != SS && y != SS && p != SS" ],
    [ "one SS", "((b == SS) + (y == SS) + (p == SS)) == 1" ],
    [ "two SS", "((b == SS) + (y == SS) + (p == SS)) == 2" ],
    [ "RR", null ], [ "SS", null ]
]);

addFilters([ [ "blue is smallest", "b < y && b < p" ],
             [ "yellow is smallest", "y < b && y < p" ],
             [ "purple is smallest", "p < b && p < y" ] ]);

addFilters([ [ "blue is largest", "b > y && b > p" ],
             [ "yellow is largest", "y > b && y > p" ],
             [ "purple is largest", "p > b && p > y" ] ]);

addFilters([ [ "blue largest or tied", "(b > y && b >= p) || (b >= y && b > p)" ],
             [ "yellow largest or tied", "(y > b && y >= p) || (y >= b && y > p)" ],
             [ "purple largest or tied", "(p > b && p >= y) || (p >= b && p > y)" ] ]);

addFilters([ [ "blue smallest or tied", "(b < y && b <= p) || (b <= y && b < p)" ],
             [ "yellow smallest or tied", "(y < b && y <= p) || (y <= b && y < p)" ],
             [ "purple smallest or tied", "(p < b && p <= y) || (p <= b && p < y)" ] ]);

addFilters([ [ "blue smallest", "b < y && b < p" ],
             [ "yellow smallest", "y < b && y < p" ],
             [ "purple smallest", "p < b && p < y" ],
             [ "blue largest", "b > y && b > p" ],
             [ "yellow largest", "y > b && y > p" ],
             [ "purple largest", "p > b && p > y" ] ]);

addFilters([
    [ "blue < yellow", "b < y" ],
    [ "blue = yellow", "b == y" ],
    [ "blue > yellow", "b > y" ],
    [ "yellow < purple", "y < p" ],
    [ "yellow = purple", "y == p" ],
    [ "yellow > purple", "y > p" ],
    [ "blue < purple", "b < p" ],
    [ "blue = purple", "b == p" ],
    [ "blue > purple", "b > p" ]
]);

addFilters([ [ "blue < yellow", "b < y" ], [ "blue = yellow", "b == y" ], [ "blue > yellow", "b > y" ] ]);
addFilters([ [ "yellow < purple", "y < p" ], [ "yellow = purple", "y == p" ], [ "yellow > purple", "y > p" ] ]);
addFilters([ [ "blue < purple", "b < p" ], [ "blue = purple", "b == p" ], [ "blue > purple", "b > p" ] ]);

addFilters([ [ "ascending", "b < y && y < p" ],
             [ "descending", "b > y && y > p" ],
             [ "no order", "!(b < y && y < p) && !(b > y && y > p)" ] ]);

function descending(b, y, p)
{
    var count = 1;
    if ((b - 1) == y) count += 1;
    if ((y - 1) == p) count += 1;
    return count;
}

function ascending(b, y, p)
{
    var count = 1;
    if ((b + 1) == y) count += 1;
    if ((y + 1) == p) count += 1;
    return count;
}

addFilters([ [ "no asc", "ascending(b,y,p) == 1" ],
             [ "two asc", "ascending(b,y,p) == 2" ],
             [ "three asc", "ascending(b,y,p) == 3" ] ]);

addFilters([ [ "no desc", "descending(b,y,p) == 1" ],
             [ "two desc", "descending(b,y,p) == 2" ],
             [ "three desc", "descending(b,y,p) == 3" ] ]);

addFilters([ [ "no asc or desc", "ascending(b,y,p) == 1 && descending(b,y,p) == 1" ],
             [ "two asc or desc", "ascending(b,y,p) == 2 || descending(b,y,p) == 2" ],
             [ "three asc or desc", "ascending(b,y,p) == 3 || descending(b,y,p) == 3" ] ]);

addFilters([ [ "blue is even", "b % 2 == 0" ], [ "blue is odd", "b % 2 != 0" ] ]);
addFilters([ [ "yellow is even", "y % 2 == 0" ], [ "yellow is odd", "y % 2 != 0" ] ]);
addFilters([ [ "purple is even", "p % 2 == 0" ], [ "purple is odd", "p % 2 != 0" ] ]);

addFilters([ [ "total is even", "(b + y + p) % 2 == 0" ], [ "total is odd", "(b + y + p) % 2 != 0" ] ]);
addFilters([ [ "total mult 3", "(b + y + p) % 3 == 0" ],
             [ "total mult 4", "(b + y + p) % 4 == 0" ],
             [ "total mult 5", "(b + y + p) % 5 == 0" ] ]);

addFilters([ [ "no pairs", "(b != y && b != p && y != p) || (b == y && y == p)" ],
             [ "one pair", "(b == y && y != p) || (y == p && p != b) || (b == p && p != y)" ] ]);

addFilters([ [ "triple number", "(b == y && y == p)" ],
             [ "double number", "(b == y && b != p) || (y == p && y != b) || (b == p && b != y)" ],
             [ "no repetition", "(b != y && y != p && b != p)" ] ]);

addFilters([ [ "more evens", "((b % 2 + y % 2 + p % 2) < 2)" ], [ "more odds", "((b % 2 + y % 2 + p % 2) >= 2)" ] ]);

addFilters([ [ "no evens", "evenCount(b, y, p) == 0" ],
             [ "one even", "evenCount(b, y, p) == 1" ],
             [ "two evens", "evenCount(b, y, p) == 2" ],
             [ "three evens", "evenCount(b, y, p) == 3" ] ]);

addFilters([ [ "no odds", "oddCount(b, y, p) == 0" ],
             [ "one odd", "oddCount(b, y, p) == 1" ],
             [ "two odd", "oddCount(b, y, p) == 2" ] ]);

unique_solutions = [];
function clearUniqueSolutions()
{
    unique_solutions = [];
    refresh();
}

var solution = [];
for (let b = 1; b <= 5; b++)
{
    for (let y = 1; y <= 5; y++)
    {
        for (let p = 1; p <= 5; p++)
        {
            var tuple = { };
            tuple.blue = b;
            tuple.yellow = y;
            tuple.purple = p;
            solution.push(tuple);
        }
    }
}

function uncheck()
{
    for (var input of document.querySelectorAll('input[type="checkbox"]'))
        input.checked = false;
    refresh();
}

function evenCount(b, y, p)
{
    var count = 0;
    if (b % 2 == 0) count++;
    if (y % 2 == 0) count++;
    if (p % 2 == 0) count++;
    return count;
}

function oddCount(b, y, p)
{
    return 3 - evenCount(b, y, p);
}

function permuteUniques()
{
    clearUniqueSolutions();
    permute(true);
}

var permute_calls = 0;
// runs through every permutation of the activated rows
function permute(unique)
{
    permute_calls += 1;
    if (permute_calls > 1000)
    {
        permute_calls = 0;
        return;
    }
    var row_list = filterTable.getElementsByTagName('tr');
    var activateTheNextCheckbox = false;
    for (var rowIdx = row_list.length - 1; rowIdx >= 0; rowIdx -= 1)
    {
        var row = row_list[rowIdx];
        var checkbox_list = row.querySelectorAll('input[type="checkbox"]');

        if (row.style.backgroundColor != activated) continue;

        for (var checkbox of checkbox_list)
        {
            if (checkbox.checked)
            {
                checkbox.checked = false;
                activateTheNextCheckbox = true;
            }
            else if (activateTheNextCheckbox)
            {
                checkbox.checked = true;
                activateTheNextCheckbox = false;
                break;
            }
        }
        if (activateTheNextCheckbox)
        {
            // we ran out of checkboxes; reset this row and update the one above it
            checkbox_list[0].checked = true;
            checkbox_list[checkbox_list.length - 1].checked = false;
            activateTheNextCheckbox = false;
        }
        else
        {
            // we moved one checkmark so we are done and ready for refresh
            break;
        }
    }

    var new_solutions = refresh();
    if (!unique)
        return;

    // we only want unique solutions
    if (new_solutions.length != 1)
    {
        // this solution was not unique
        return permute(true);
    }

    // this solution was unique
    // but we need to make sure all the verifiers were meaningful
    for (var row of row_list)
    {
        if (row.style.backgroundColor != activated) continue;
        for (var checkbox of row.querySelectorAll('input[type="checkbox"]'))
        {
            if (!checkbox.checked) continue;

            // uncheck the box and see if the count has changed
            checkbox.checked = false;
            var more_solutions = refresh();
            checkbox.checked = true;
            if (more_solutions.length == 1)
            {
                // there's still only one solution
                // so this verifier was useless
                // keep searching
                return permute(true);
            }
            // there's more than one solution
            // this particular verifier was meaningful
            // so we check all the others
            break;
        }
    }
    // if we make it here, we found a unique and valid possible solution
    if (!unique_solutions.includes(new_solutions[0]))
        unique_solutions.push(new_solutions[0])
    refresh();
}

// this version applies all the filters and reports unique solutions
function specialRefresh()
{
    var result = '';
    var count = 0;
    var AA, BB, CC, DD, EE, FF, GG, HH, II, JJ, KK, LL, MM, NN, OO, PP, QQ, RR, SS;
    for (const input of document.getElementsByTagName('input'))
    {
        if (input.value != '' && input.type == "number")
             eval(input.id + "=" + input.value);
    }

    for (const item of solution)
    {
        var include = true;
        var b = item.blue;
        var y = item.yellow;
        var p = item.purple;

        // apply filters
        for (const [checkbox, test] of filterList)
        {
            if (checkbox.checked && !eval(test))
                include = false;
        }
        
        if (include)
        {
            if (count > 0)
                return;
            result += b.toString() + y.toString() + p.toString() + " ";
            count += 1;
        }
    }
    if (count)
        show(result + "<br>");
}

// this version applies all the filters and shows the current solution set
function refresh(reset = true)
{
    if (reset) solutionElement.innerHTML = "";

    var solutions = [ ];
    var prev_blue = -1;
    var prev_yellow = 1;
    var count = 0;
    var AA, BB, CC, DD, EE, FF, GG, HH, II, JJ, KK, LL, MM, NN, OO, PP, QQ, RR, SS;
    for (const input of document.getElementsByTagName('input'))
    {
        if (input.value != '' && input.type == "number")
             eval(input.id + "=" + input.value);
    }

    for (const item of solution)
    {
        var include = true;
        var b = item.blue;
        var y = item.yellow;
        var p = item.purple;
        var applied = 0;

        // apply filters
        for (const [checkbox, test] of filterList)
        {
            if (checkbox.checked)
            {
                applied += 1;
                if (!eval(test))
                    include = false;
            }
        }
        
        if (y != prev_yellow)
        {
            if (b != prev_blue)
                show('<br>');
            else
                show(' | ');
        }
        else if (b == prev_blue)
        {
            show(' ');
        }

        if (include)
        {
            count += 1;
            show(b);
            show(y);
            show(p);
            solutions.push(b.toString() + y.toString() + p.toString());
        }
        else
            show('...');
        
        prev_blue = b;
        prev_yellow = y;
    }
    show("<br><br>count: " + count);
    show("<br><br>applied " + applied + " filters<br>");
    if (unique_solutions.length)
    {
        show("<br>unique solutions:");
        for (const s of unique_solutions)
            show(" " + s);
    }
    return solutions;
}
refresh();

</script>
</body>
</html>
